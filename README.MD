# Binance historical storage
## Цель проекта
Предпологается, что будет использоваться как API для построения сервисов связанных с выводом информации о криптовалюте (пока только добавлены свечи BTCUSDT). 

## Зависимости от third-party
В качестве хранилища данных используется Postgres.

Библиотека Libpqxx используется для взаимодействия с Postgres.

Библиотека flatbuffers используется для zero-copy сериализации данных.

Библиотека http-lib используется для сетевого взаимодействия. В будущем добавлю поддержку boost::beast.

Библиотека binacpp используется для получения данных с биржи Binance. Ее пришлось форкнуть, так как нужно было добавить поддержку api v3 from Binance и CMake сборку.

Все используемые библиотеки затянуты в проект при помощи git submodule.

## Как собрать проект?
Для сборки проекта используется CMake и генератор Ninja. А так же должен быть установлен curl и docker-compose в системе. Проект собирается как STATIC библиотека.

Файл конфигурации для запуска через docker compose находится в корне репозитория. Он подтягивает образ Postgres и adminer (web-морда для Postgres).

Например, чтобы установить curl в Arch Linux, введите команду в терминале:
```shell 
pacman -Sy curl docker-composes
```

Запуск рабочего окружения в docker-compose в корне репозитория:
```shell
sudo docker-compose up -d 
```

Клонируем репозиторий:
```shell
git clone https://github.com/lpdgrl/FHC.git
```

Подтягиваем зависимости:
```shell
git submodule update --init --recursive
```

Выполняем сборку в корне репозитория:
```shell
mkdir build && cd build
cmake .. -G Ninja
cmake --build . 
```

В папке examples находится http-пример для запуска.  
Перед первым запуском нужно подготовить конфигурацию в конфиг-файле (.nfile) в директории config. С репозиторием поставляется шаблонный конфиг-файл .nfile-template и для быстрого старта 
вы можете его переименовать в .nfile

```shell
mv .nfile-template .nfile
```

Структура конфиг-файла простая:
```shell
    DB_HOST=localhost    # хост базы данных Postgres
    DB_NAME=postgres     # имя базы данных
    DB_USER=postgres     # имя пользователя базы данных
    DB_PASSWORD=postgres # пароль базы данных
    HTTP_HOST=0.0.0.0    # ip-address http-сервера
    HTTP_PORT=8000       # порт http-сервера
```

Теперь все готово, и чтобы запустить http-пример, введите в терминал:
```shell
{подставить свой путь}/build/examples/http_example
```
или, если находитесь в ./build/examples/

```shell
./http-example
```

## Как использовать?
При первоначальном запуске, база данных будет заполняться свечами BTCUSDT с захардкоженной датой 2025-08-01 по текущую дату. Планирую в будущем, добавить возможность чтобы заполнять базу данных с произвольной даты.

В строке браузера введите:
```shell
http://localhost:8000/
``` 
и вам отобразится веб-страница с выбором дат для получения flatbuffer со свечами по BTCUSDT за выбранный период. Для проверки, что массив байтов пришел, необходимо открыть в браузере консоль из инструментов разработчика и увидите количество переданных байтов и массив сырых байтов. 

Чтобы получить обновления по свечам (пока только BTCUSDT) введите в браузере:
```shell
http://localhost:8000/api/update 
```
После заполнения базы данных новыми данными на странице отобразится количество добавленных свечей в базу данных либо, что данные в базе данных на текущее время актуальны.

## Какой функционал реализован?
SQL Loader для загрузки sql-файлов и подстановка в них параметров при помощи механизма libpqxx.

Передача произвольного GET-обработчика внутрь httplib. Это подробно показано в примере examples\http-example.

Получение и обновление klines по одной криптовалюте.

[TODO проекта](TODO.MD)